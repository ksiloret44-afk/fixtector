# Configuration Virtual Host Apache pour FixTector
# Remplacez example.com par votre domaine réel
# Placez ce fichier dans: C:\Apache24\conf\extra\vhost-example.com.conf
# Ou créez un fichier séparé et incluez-le dans httpd.conf

<VirtualHost *:80>
    # Nom de domaine
    ServerName example.com
    ServerAlias www.example.com
    
    # DocumentRoot (optionnel, pour fichiers statiques)
    DocumentRoot "C:/Apache24/htdocs/fixtector"
    
    # Logs
    ErrorLog "logs/example.com-error.log"
    CustomLog "logs/example.com-access.log" combined
    
    # Redirection HTTPS (recommandé pour production)
    # Décommentez pour forcer HTTPS
    # RewriteEngine On
    # RewriteCond %{HTTPS} off
    # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    
    # Proxy vers Node.js Next.js
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Redirection vers Node.js sur le port 3001
    ProxyPass / http://localhost:3001/
    ProxyPassReverse / http://localhost:3001/
    
    # WebSocket support (pour HMR et WebSockets)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*) ws://localhost:3001/$1 [P,L]
    
    # Headers de sécurité
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Compression
    LoadModule deflate_module modules/mod_deflate.so
    <Location />
        SetOutputFilter DEFLATE
        SetEnvIfNoCase Request_URI \
            \.(?:gif|jpe?g|png|ico|zip|gz|bz2|pdf|mp3|mp4|mov|avi|wmv|flv|swf)$ no-gzip dont-vary
    </Location>
</VirtualHost>

# Configuration HTTPS (SSL)
<VirtualHost *:443>
    # Nom de domaine
    ServerName example.com
    ServerAlias www.example.com
    
    # DocumentRoot (optionnel)
    DocumentRoot "C:/Apache24/htdocs/fixtector"
    
    # Logs
    ErrorLog "logs/example.com-ssl-error.log"
    CustomLog "logs/example.com-ssl-access.log" combined
    
    # SSL Configuration
    SSLEngine on
    
    # Certificat SSL (Let's Encrypt recommandé pour production)
    # Pour Let's Encrypt avec Certbot:
    SSLCertificateFile "C:/Apache24/conf/ssl/example.com/fullchain.pem"
    SSLCertificateKeyFile "C:/Apache24/conf/ssl/example.com/privkey.pem"
    
    # Certificat intermédiaire (Let's Encrypt)
    # SSLCertificateChainFile "C:/Apache24/conf/ssl/example.com/chain.pem"
    
    # Pour certificat auto-signé (développement uniquement):
    # SSLCertificateFile "C:/Apache24/conf/ssl/example.com.crt"
    # SSLCertificateKeyFile "C:/Apache24/conf/ssl/example.com.key"
    
    # SSL Protocol (sécurisé)
    SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite HIGH:!aNULL:!MD5:!3DES
    SSLHonorCipherOrder on
    
    # HSTS (HTTP Strict Transport Security)
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
    # Proxy vers Node.js Next.js
    ProxyPreserveHost On
    ProxyRequests Off
    
    ProxyPass / http://localhost:3001/
    ProxyPassReverse / http://localhost:3001/
    
    # WebSocket support
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*) ws://localhost:3001/$1 [P,L]
    
    # Headers de sécurité
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Content-Security-Policy "default-src 'self'"
    
    # Compression
    <Location />
        SetOutputFilter DEFLATE
        SetEnvIfNoCase Request_URI \
            \.(?:gif|jpe?g|png|ico|zip|gz|bz2|pdf|mp3|mp4|mov|avi|wmv|flv|swf)$ no-gzip dont-vary
    </Location>
</VirtualHost>












