# Configuration Apache pour FixTector (Reverse Proxy)
# Placez ce fichier dans: C:\Apache24\conf\extra\fixtector.conf
# Ou dans le répertoire de configuration Apache sur votre système

<VirtualHost *:80>
    ServerName localhost
    ServerAlias fixtector.local
    
    # Logs
    ErrorLog "logs/fixtector-error.log"
    CustomLog "logs/fixtector-access.log" combined
    
    # Proxy vers Node.js Next.js
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Redirection vers Node.js sur le port 3001
    ProxyPass / http://localhost:3001/
    ProxyPassReverse / http://localhost:3001/
    
    # Headers pour Next.js
    ProxyPassReverse / http://localhost:3001/
    ProxyPassReverse / http://localhost:3001/
    
    # WebSocket support (pour HMR en développement)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*) ws://localhost:3001/$1 [P,L]
    
    # Headers de sécurité
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Compression
    LoadModule deflate_module modules/mod_deflate.so
    <Location />
        SetOutputFilter DEFLATE
        SetEnvIfNoCase Request_URI \
            \.(?:gif|jpe?g|png|ico|zip|gz|bz2|pdf|mp3|mp4|mov|avi|wmv|flv|swf)$ no-gzip dont-vary
    </Location>
</VirtualHost>

# Configuration HTTPS (à activer après installation du certificat SSL)
<VirtualHost *:443>
    ServerName localhost
    ServerAlias fixtector.local
    
    # Logs
    ErrorLog "logs/fixtector-ssl-error.log"
    CustomLog "logs/fixtector-ssl-access.log" combined
    
    # SSL Configuration
    SSLEngine on
    SSLCertificateFile "conf/ssl/fixtector.crt"
    SSLCertificateKeyFile "conf/ssl/fixtector.key"
    
    # SSL Protocol
    SSLProtocol all -SSLv2 -SSLv3
    SSLCipherSuite HIGH:!aNULL:!MD5
    
    # Proxy vers Node.js sur le port 3001
    ProxyPreserveHost On
    ProxyRequests Off
    
    ProxyPass / http://localhost:3001/
    ProxyPassReverse / http://localhost:3001/
    
    # WebSocket support
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*) ws://localhost:3001/$1 [P,L]
    
    # Headers de sécurité
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Compression
    <Location />
        SetOutputFilter DEFLATE
        SetEnvIfNoCase Request_URI \
            \.(?:gif|jpe?g|png|ico|zip|gz|bz2|pdf|mp3|mp4|mov|avi|wmv|flv|swf)$ no-gzip dont-vary
    </Location>
</VirtualHost>














